<%- include('../partials/header.html') %>

<div class="page-header">
    <h1>Configurar Suscripciones</h1>
    <p>Ofrece contenido exclusivo a tus seguidores a cambio de una tarifa mensual.</p>
</div>

<div class="dashboard-grid">
    <div class="form-container" style="max-width: none;">
        <% if (locals.success) { %><div class="alert alert-success"><%= success %></div><% } %>
        <% if (locals.error) { %><div class="alert alert-danger"><%= error %></div><% } %>
        
        <form action="/settings/subscriptions" method="POST">
            <div class="form-group form-group-checkbox" style="padding: 1rem; background: #2a2a2a; border-radius: var(--border-radius-soft);">
                <input type="checkbox" id="isActive" name="isActive" <%= currentUser.subscriptionSettings && currentUser.subscriptionSettings.isActive ? 'checked' : '' %>>
                <label for="isActive"><strong>Activar Suscripciones en mi perfil</strong></label>
            </div>

            <div class="form-group" style="margin-top: 2rem;">
                <label>Elige un precio para tu suscripción mensual:</label>
                <% 
                // Los precios base de los paquetes
                const prices = [300, 600, 1000, 1250]; 
                // Tasa de conversión de TPYS a Guaraníes (asumiendo 1 TPYS = 100 Gs)
                const tpysToGsRate = 100;
                %>
                <% prices.forEach(priceValue => { 
                    // Calculamos la ganancia neta y en guaraníes dinámicamente
                    const netEarningTpys = priceValue * CREATOR_EARNING_RATE;
                    const netEarningGs = netEarningTpys * tpysToGsRate;
                %>
                    <div class="radio-option">
                        <input type="radio" id="price_<%= priceValue %>" name="price" value="<%= priceValue %>" <%= currentUser.subscriptionSettings && currentUser.subscriptionSettings.price === priceValue ? 'checked' : '' %>>
                        <label for="price_<%= priceValue %>">
                            <strong><%= priceValue %> TPYS / mes</strong>
                            <span class="status">
                                Recibes <%= netEarningTpys.toFixed(0) %> TPYS 
                                (aprox. <%= netEarningGs.toLocaleString('es-PY', {style:'currency', currency:'PYG'}) %>) por suscriptor.
                            </span>
                        </label>
                    </div>
                <% }) %>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%;">Guardar Configuración</button>
        </form>
    </div>
    
    <div class="dashboard-card" style="background-color: #2a2a2a;">
        <h3><i class="fas fa-rocket" style="color: var(--primary-color);"></i> ¿Cómo funcionan las suscripciones?</h3>
        <p>Al activar las suscripciones, tus seguidores podrán pagarte una cuota mensual para acceder a contenido que marques como "exclusivo para suscriptores".</p>
        <p>Recibirás el <strong><%= (CREATOR_EARNING_RATE * 100).toFixed(0) %>%</strong> de cada suscripción, que se añadirá directamente a tu saldo de TPYS.</p>
        <hr style="border-color: #444;">
        
        <% 
            const examplePrice = 600;
            const exampleEarningPerSub = (examplePrice * CREATOR_EARNING_RATE) * 100; // Ganancia en Gs por sub
        %>

        <h4><i class="fas fa-calculator"></i> Proyección de ganancias</h4>
        <p>Imagina que tienes <strong>100 suscriptores</strong> con el plan de <%= examplePrice %> TPYS:</p>
        <p style="color: var(--success-color); font-weight: bold; font-size: 1.2rem;">Ganarías aprox. <%= (100 * exampleEarningPerSub).toLocaleString('es-PY', {style:'currency', currency:'PYG'}) %> al mes.</p>
        <br>
        <p>Si llegas a <strong>1000 suscriptores</strong> con ese mismo plan:</p>
        <p style="color: var(--success-color); font-weight: bold; font-size: 1.4rem;">¡Ganarías aprox. <%= (1000 * exampleEarningPerSub).toLocaleString('es-PY', {style:'currency', currency:'PYG'}) %> al mes!</p>
    </div>
</div>

<style>
    .radio-option {
        padding: 1rem;
        border: 1px solid #444;
        border-radius: var(--border-radius-soft);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        cursor: pointer;
    }
    .radio-option:hover {
        background-color: #2a2a2a;
    }
    .radio-option input[type="radio"] {
        width: auto;
    }
    .radio-option label {
        margin: 0;
        cursor: pointer;
        width: 100%;
    }
    .radio-option label .status {
        color: var(--text-muted-color);
        display: block;
        font-size: 0.9rem;
    }
    .alert { padding: 1rem; margin-bottom: 1rem; border-radius: 5px; border: 1px solid transparent; }
    .alert-success { background-color: rgba(76, 175, 80, 0.1); border-color: var(--success-color); color: var(--success-color); }
    .alert-danger { background-color: rgba(244, 67, 54, 0.1); border-color: var(--danger-color); color: var(--danger-color); }
</style>

<%- include('../partials/footer.html') %>